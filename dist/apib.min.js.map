{"version":3,"file":"apib.min.js","sources":["../lib/apib.js"],"sourcesContent":["'use strict'\r\n\r\nimport axios from 'axios'\r\n\r\nimport { version } from '../package.json'\r\n\r\nclass API {\r\n  axios = axios\r\n\r\n  version = version\r\n\r\n  constructor(options = {}) {\r\n    this.options = options\r\n  }\r\n\r\n  log(...args) {\r\n    if (this.options.debug) {\r\n      console.log(...args) // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 将对象转为 URL QueryString\r\n   *\r\n   * @param {object} data\r\n   */\r\n  _param(data) {\r\n    let ret = []\r\n    Object.keys(data).forEach(v => {\r\n      ret.push(`${encodeURIComponent(v)}=${encodeURIComponent(data[v])}`)\r\n    })\r\n    return ret.join('&')\r\n  }\r\n\r\n  /**\r\n   * 类型判断\r\n   *\r\n   * @param {*} unknown\r\n   * @return {string}\r\n   */\r\n  _type(unknown) {\r\n    const type = Object.prototype.toString.call(unknown)\r\n    return type.replace('[object ', '').replace(']', '').toLowerCase()\r\n  }\r\n\r\n  /**\r\n   * 将参数列表转为对象形式\r\n   *\r\n   * @param {array} args 参数原始对象，即 arguments\r\n   * @param {array} names 参数名称对应的数组，可以给默认值，默认值需要能被 JSON.parse 解析。\r\n   *\r\n   * 注意：\r\n   *  - 参数的值支持覆盖\r\n   *  - 在遇到对象之后直接退出\r\n   *\r\n   * 示例：\r\n   *   > _args ([1, 2, {xor: true}], ['offset', 'count'])\r\n   *   < {offset: 1, count: 2, xor: true}\r\n   */\r\n  _args(args, names = []) {\r\n    const options = {}\r\n    names.forEach((item, index) => {\r\n      if (item.indexOf('=') > -1) {\r\n        const temp = item.split('=')\r\n        const name = temp[0]\r\n        names[index] = name\r\n        try {\r\n          options[name] = JSON.parse(temp.slice(1).join('='))\r\n        } catch (e) {\r\n          //\r\n        }\r\n        // const [name, ...value] = item.split('=')\r\n        // names[index] = name\r\n        // try {\r\n        //   options[name] = JSON.parse(value.join('='))\r\n        // } catch (e) {\r\n        //   //\r\n        // }\r\n      }\r\n    })\r\n    for (let i = 0; i < args.length; i++) {\r\n      if (this._type(args[i]) === 'object') {\r\n        Object.assign(options, args[i])\r\n        break\r\n      } else if (\r\n        this._type(args[i]) !== 'undefined'\r\n        && this._type(names[i]) !== 'undefined'\r\n      ) {\r\n        options[names[i]] = args[i]\r\n      }\r\n    }\r\n    return options\r\n  }\r\n\r\n  /**\r\n   * 拼接链接地址\r\n   *\r\n   * @param  {array<string>} args\r\n   */\r\n  _join(...args) {\r\n    let result = args[0] || ''\r\n    for (let i = 1; i < args.length; i++) {\r\n      if (args[i]) {\r\n        result = result.replace(/\\/+$/, '') + '/' + args[i].replace(/^\\/+/, '')\r\n      }\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 通用请求封装\r\n   */\r\n  request(...args) {\r\n    const options = this._args(args, ['url'])\r\n\r\n    if (!options.url) {\r\n      throw new Error('url is required')\r\n    }\r\n\r\n    if (!options.method && this.options.method) {\r\n      options.method = this.options.method\r\n    }\r\n\r\n    const successCode = typeof this.options.code === 'number' ? this.options.code : 1\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.axios.create({\r\n        withCredentials: true,\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        baseURL: this.options.baseUrl,\r\n        timeout: this.options.timeout\r\n      })(options).then(response => {\r\n        let res = response.data || {}\r\n\r\n        const code = +res.code\r\n\r\n        if (code === successCode) {\r\n          resolve(res)\r\n        } else {\r\n          reject(res)\r\n        }\r\n        this.log('then', {response, args, options, res, raw: JSON.stringify(res)})\r\n      }).catch(error => {\r\n        reject(error)\r\n        this.log('catch', {error, args, options, response: error.response})\r\n      })\r\n    })\r\n  }\r\n\r\n}\r\n\r\nexport default API\r\n"],"names":["options","axios","version","log","this","debug","console","_param","data","ret","Object","keys","forEach","v","push","encodeURIComponent","join","_type","unknown","prototype","toString","call","replace","toLowerCase","_args","args","names","item","index","indexOf","temp","split","name","JSON","parse","slice","e","i","length","assign","_join","result","request","url","Error","method","successCode","code","Promise","resolve","reject","_this","create","withCredentials","headers","baseURL","baseUrl","timeout","then","response","res","raw","stringify","error"],"mappings":"4SAWcA,yDAAU,QAJtBC,MAAQA,OAERC,qBAGOF,QAAUA,6BAGjBG,IAAA,iBACMC,KAAKJ,QAAQK,UACfC,SAAQH,0BASZI,OAAA,SAAOC,OACDC,EAAM,UACVC,OAAOC,KAAKH,GAAMI,QAAQ,SAAAC,GACxBJ,EAAIK,eAAQC,mBAAmBF,eAAME,mBAAmBP,EAAKK,QAExDJ,EAAIO,KAAK,QASlBC,MAAA,SAAMC,UACSR,OAAOS,UAAUC,SAASC,KAAKH,GAChCI,QAAQ,WAAY,IAAIA,QAAQ,IAAK,IAAIC,iBAiBvDC,MAAA,SAAMC,EAAN,OAAYC,+BAAZ,EAAA,EAAoB,GACZ1B,EAAU,GAChB0B,EAAMd,QAAQ,SAACe,EAAMC,OACM,EAArBD,EAAKE,QAAQ,KAAW,KACpBC,EAAOH,EAAKI,MAAM,KAClBC,EAAOF,EAAK,GAClBJ,EAAME,GAASI,MAEbhC,EAAQgC,GAAQC,KAAKC,MAAMJ,EAAKK,MAAM,GAAGnB,KAAK,MAC9C,MAAOoB,YAYR,IAAIC,EAAI,EAAGA,EAAIZ,EAAKa,OAAQD,IAAK,IACR,WAAxBjC,KAAKa,MAAMQ,EAAKY,IAAkB,CACpC3B,OAAO6B,OAAOvC,EAASyB,EAAKY,UAGJ,cAAxBjC,KAAKa,MAAMQ,EAAKY,KACY,cAAzBjC,KAAKa,MAAMS,EAAMW,MAEpBrC,EAAQ0B,EAAMW,IAAMZ,EAAKY,WAGtBrC,KAQTwC,MAAA,sCAASf,2BAAAA,0BACHgB,EAAShB,EAAK,IAAM,GACfY,EAAI,EAAGA,EAAIZ,EAAKa,OAAQD,IAC3BZ,EAAKY,KACPI,EAASA,EAAOnB,QAAQ,OAAQ,IAAM,IAAMG,EAAKY,GAAGf,QAAQ,OAAQ,YAGjEmB,KAMTC,QAAA,6CAAWjB,2BAAAA,sBACHzB,EAAUI,KAAKoB,MAAMC,EAAM,CAAC,YAE7BzB,EAAQ2C,UACL,IAAIC,MAAM,oBAGb5C,EAAQ6C,QAAUzC,KAAKJ,QAAQ6C,SAClC7C,EAAQ6C,OAASzC,KAAKJ,QAAQ6C,YAG1BC,EAA2C,iBAAtB1C,KAAKJ,QAAQ+C,KAAoB3C,KAAKJ,QAAQ+C,KAAO,SAEzE,IAAIC,QAAQ,SAACC,EAASC,GAC3BC,EAAKlD,MAAMmD,OAAO,CAChBC,iBAAiB,EACjBC,QAAS,gBACS,oBAElBC,QAASJ,EAAKnD,QAAQwD,QACtBC,QAASN,EAAKnD,QAAQyD,SANxBN,CAOGnD,GAAS0D,KAAK,SAAAC,OACXC,EAAMD,EAASnD,MAAQ,IAEboD,EAAIb,OAELD,EACXG,EAAQW,GAERV,EAAOU,GAETT,EAAKhD,IAAI,OAAQ,CAACwD,SAAAA,EAAUlC,KAAAA,EAAMzB,QAAAA,EAAS4D,IAAAA,EAAKC,IAAK5B,KAAK6B,UAAUF,aAC7D,SAAAG,GACPb,EAAOa,GACPZ,EAAKhD,IAAI,QAAS,CAAC4D,MAAAA,EAAOtC,KAAAA,EAAMzB,QAAAA,EAAS2D,SAAUI,EAAMJ"}